<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://xuxuzhaozhao2015.github.io</id>
    <title>xuxuzhaozhao</title>
    <updated>2020-01-02T01:51:23.869Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://xuxuzhaozhao2015.github.io"/>
    <link rel="self" href="https://xuxuzhaozhao2015.github.io/atom.xml"/>
    <subtitle>Aspire to inspire until I expire.</subtitle>
    <logo>https://xuxuzhaozhao2015.github.io/images/avatar.png</logo>
    <icon>https://xuxuzhaozhao2015.github.io/favicon.ico</icon>
    <rights>All rights reserved 2020, xuxuzhaozhao</rights>
    <entry>
        <title type="html"><![CDATA[åœ¨é˜¿é‡Œäº‘ Centos 7 ä¸Šéƒ¨ç½²docker redisã€mysql 8.0.18]]></title>
        <id>https://xuxuzhaozhao2015.github.io/post/linuxdeployredis</id>
        <link href="https://xuxuzhaozhao2015.github.io/post/linuxdeployredis">
        </link>
        <updated>2020-01-02T01:43:09.000Z</updated>
        <content type="html"><![CDATA[<blockquote>
<p>è®°å¾—åœ¨é˜¿é‡Œäº‘æ§åˆ¶ç«¯ä¸­å°†3306ä¸6379ç«¯å£åŠ å…¥å®‰å…¨ç»„ã€‚</p>
</blockquote>
<hr>
<h2 id="redis">redisğŸ˜€</h2>
<h3 id="1-è·å–redis">1ã€è·å–redis</h3>
<ul>
<li>docker search redis</li>
<li>docker pull redis:latest</li>
<li>docker images</li>
</ul>
<h3 id="2-åˆ›å»ºå®¿ä¸»æœº">2ã€åˆ›å»ºå®¿ä¸»æœº</h3>
<pre><code># åœ¨æ ¹ç›®å½•æ–°å»ºä¸¤ä¸ªæ•°æ®å·æ–‡ä»¶å¤¹
mkdir /home/docker/redis/{conf,data} -p
cd /home/docker/redis/conf

# è·å–é»˜è®¤çš„redis.confæ¨¡ç‰ˆ
wget http://download.redis.io/redis-stable/redis.conf

# ç¼–è¾‘redis.conf
requirepass fuckyouhacker #å¿…é¡»ä½¿ç”¨å¯†ç 
appendonly yes #æ•°æ®append
logfile &quot;access.log&quot; #æ—¥å¿—è®°å½•æ–‡ä»¶å

# è¿œç¨‹è®¿é—® æ³¨é‡Šæ‰ 127.0.0.1
# bind 127.0.0.1
protected-mode no # å¯ç”¨è¿œç¨‹è®¿é—®

# é€€å‡ºconfè¿›å…¥/home/docker/redis
cd ..
</code></pre>
<h3 id="3-è¿è¡Œredis">3ã€è¿è¡Œredis</h3>
<pre><code># å‘½ä»¤åˆ†è§£
docker run \
-p 6379:6379 \ # ç«¯å£æ˜ å°„ å®¿ä¸»æœº:å®¹å™¨
-v $PWD/data:/data:rw \ # æ˜ å°„æ•°æ®ç›®å½• rw ä¸ºè¯»å†™ï¼Œå¿…é¡»ä½¿ç”¨ç»å¯¹è·¯å¾„
-v $PWD/conf/redis.conf:/etc/redis/redis.conf:ro \ # æŒ‚è½½é…ç½®æ–‡ä»¶ ro ä¸ºreadonlyï¼Œå¿…é¡»ä½¿ç”¨ç»å¯¹è·¯å¾„
--privileged=true \ # ç»™ä¸ä¸€äº›æƒé™
--name myredis \ # ç»™å®¹å™¨èµ·ä¸ªåå­—
-d redis /etc/redis/redis.conf # deamon è¿è¡Œå®¹å™¨
</code></pre>
<h3 id="4-æŸ¥çœ‹-myredis">4ã€æŸ¥çœ‹ <code>myredis</code></h3>
<pre><code>docker images

# å¦‚æœæ²¡æœ‰çœ‹åˆ°ä»»ä½•å®¹å™¨ï¼Œåˆ™è¯´æ˜å‡ºé”™äº†ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ—¥å¿—
docker logs myredis

# æŸ¥çœ‹ myredis çš„ ip æŒ‚è½½ ç«¯å£æ˜ å°„ç­‰ä¿¡æ¯
docker inspect myredis
# æŸ¥çœ‹ myredis çš„ç«¯å£æ˜ å°„
docker port myredis
</code></pre>
<h3 id="5-è¿›å…¥myredis">5ã€è¿›å…¥<code>myredis</code></h3>
<pre><code>[root@iZuf68eahm3loty2bz4uq1Z redis]# docker exec -it myredis /bin/bash
root@338dc6c82e1e:/data# redis-cli
</code></pre>
<h3 id="6-å®¢æˆ·ç«¯è¿æ¥">6ã€å®¢æˆ·ç«¯è¿æ¥</h3>
<pre><code>redis-cli -h 47.102.xxx.xxx -p 6379
47.102.xxx.xxx:6379&gt;auth fuckhacker
</code></pre>
<p>å¼€æºå®¢æˆ·ç«¯ï¼š<br>
https://github.com/qishibo/AnotherRedisDesktopManager/releases</p>
<hr>
<h2 id="mysql-8018">mysql 8.0.18</h2>
<h3 id="1-æ‹‰å–é•œåƒ">1ã€æ‹‰å–é•œåƒ</h3>
<pre><code>docker image pull mysql:8.0.18
</code></pre>
<h3 id="2-åˆ›å»º-mysql-æ•°æ®æ–‡ä»¶å’Œé…ç½®æ–‡ä»¶-ç›®å½•">2ã€åˆ›å»º MySQL æ•°æ®æ–‡ä»¶å’Œé…ç½®æ–‡ä»¶ ç›®å½•ã€‚</h3>
<pre><code># å®¿ä¸»æœºåˆ›å»º MySQL confã€data ç›®å½•
mkdir -p /home/data/docker/mysql/{conf,data}

# åˆ›å»ºä¸€ä¸ª MySQL å®¹å™¨ï¼ˆä¸´æ—¶çš„ï¼Œåªæ˜¯ä¸ºäº†å¤åˆ¶æ–‡ä»¶ï¼‰
docker run --name mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql:8.0.18

# å¤åˆ¶å®¹å™¨ä¸­ MySQL data åˆ°å®¿ä¸»æœº
docker cp mysql:/var/lib/mysql /root/docker/mysql/data

# å¤åˆ¶å®¹å™¨ä¸­ MySQL é…ç½®æ–‡ä»¶åˆ°å®¿ä¸»æœº
docker cp mysql:/etc/mysql/my.cnf /root/docker/mysql/conf/my.cnf

# åˆ é™¤ä¸´æ—¶çš„ MySQL å®¹å™¨
docker rm -f mysql
</code></pre>
<h3 id="3-åˆ›å»ºè¿è¡Œ-mysql-å®¹å™¨">3ã€åˆ›å»ºè¿è¡Œ MySQL å®¹å™¨</h3>
<pre><code>cd /root/docker/mysql

docker run \
    -p 3306:3306 \
    -e MYSQL_ROOT_PASSWORD=123456 \
    -e TZ=Asia/Shanghai \
    -v /etc/localtime:/etc/localtime:ro \
    -v $PWD/data/mysql:/var/lib/mysql \
    -v $PWD/conf/my.cnf:/etc/mysql/my.cnf \
    --name eladmin \
    --privileged=true \
    --restart=always \
    -d mysql
    
å‚æ•°è¯´æ˜ï¼š

-p 3306:3306 å®¹å™¨ 3306 ç«¯å£æ˜ å°„åˆ°ä¸»æœº 3306 ç«¯å£
-e MYSQL_ROOT_PASSWORD=123456 æŒ‡å®š MySQL åˆå§‹å¯†ç 
-e TZ=Asia/Shanghai è®¾ç½®å®¹å™¨é»˜è®¤æ—¶åŒº
-v /etc/localtime:/etc/localtime:ro è®¾ç½®å®¹å™¨æ—¶é—´ä¸å®¿ä¸»æœºæ—¶é—´åŒæ­¥
-v /home/data/docker/mysql/data/mysql:/var/lib/mysql å°†å®¹å™¨ mysql data ç›®å½•æŒ‚è½½åˆ°å®¿ä¸»æœº
-v /home/data/docker/mysql/conf/my.cnf:/etc/mysql/my.cnf å°†å®¹å™¨ mysql é…ç½®æ–‡ä»¶æŒ‚è½½åˆ°å®¿ä¸»æœº
--name mysql_8.0.18 è®¾ç½®å®¹å™¨åç§°
--restart=always Docker æœåŠ¡å¯åŠ¨åï¼Œè‡ªåŠ¨å¯åŠ¨è¯¥å®¹å™¨
--privileged=true è®©å®¹å™¨ä¸­ root ç”¨æˆ·æ‹¥æœ‰ root æƒé™ï¼Œé»˜è®¤åªæœ‰æ™®é€šç”¨æˆ·æƒé™
-d åå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨ID
mysql:8.0.18 é•œåƒåï¼Œä¸åŠ ç‰ˆæœ¬å·ï¼Œä¼šä½¿ç”¨æœ€æ–°ç‰ˆæœ¬
</code></pre>
<h3 id="4-è¿›å…¥å®¹å™¨ä¿®æ”¹åˆå§‹å¯†ç å¼€å¯è¿œç¨‹è¿æ¥">4ã€è¿›å…¥å®¹å™¨ä¿®æ”¹åˆå§‹å¯†ç ï¼Œå¼€å¯è¿œç¨‹è¿æ¥</h3>
<pre><code># è¿›å…¥å®¹å™¨
docker exec -it mysql_8.0.18 /bin/sh

# å®¹å™¨å†…æ‰§è¡Œï¼Œè¾“å…¥åˆå§‹å¯†ç ï¼ˆå¦‚æœåˆå§‹å¯†ç ä¸å¯ä»¥ï¼Œä¸è¾“å¯†ç ç›´æ¥æ•²å›è½¦è¯•è¯•ï¼‰
mysql -u root -p

# æŒ‡å®šæ•°æ®åº“
mysql&gt; use mysql;

# ä¿®æ”¹åˆå§‹å¯†ç ï¼Œæ”¹å˜å¯†ç éªŒè¯æ–¹å¼ä¸º mysql_native_password 
mysql&gt; ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'P@ssw0rd';

# ä¿®æ”¹åˆå§‹å¯†ç ï¼Œæ”¹å˜å¯†ç éªŒè¯æ–¹å¼ä¸º mysql_native_password 
mysql&gt; ALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY 'P@ssw0rd';

# å¦‚æœä¸Šé¢çš„ sql å‡ºé”™ï¼Œæ‰§è¡Œ
mysql&gt; update user set host = '%' where user = 'root';

mysql&gt; FLUSH PRIVILEGES;

# æ‰§è¡Œå®Œä»¥ä¸Šå‘½ä»¤ï¼ŒéªŒè¯ä¸€ä¸‹
mysql&gt; select host,user,plugin from user where user = 'root';
+-----------+------+-----------------------+
| host      | user | plugin                |
+-----------+------+-----------------------+
| %         | root | mysql_native_password |
+-----------+------+-----------------------+
</code></pre>
]]></content>
    </entry>
</feed>